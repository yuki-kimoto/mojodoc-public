<!DOCTYPE html>
<html>
  <head>
    <!-- meta -->
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0">
<link rel="icon" type="image/x-icon" href="/images/mojodoc-logo.png">
<link rel="stylesheet" type="text/css" href="/css/common.css">

<script type="text/javascript" src="/js/jquery-1.9.0.min.js"></script>
<script type="text/javascript" src="/js/google-code-prettify/prettify.js"></script>
<link  type="text/css" rel="stylesheet" href="/js/google-code-prettify/prettify.css"/>

<script>
  $(function(){
    // google code prettifyの有効化
    $("pre").addClass("prettyprint");
    function init(event){
      prettyPrint();
    }
    if(window.addEventListener)window.addEventListener("load",init,false);
    else if(window.attachEvent)window.attachEvent("onload",init);
  });
</script>

<title>Mojo::Message - HTTPメッセージの基底クラス - Mojoliciousドキュメント 日本語訳</title>
<meta name="description" content="Mojo::Messageは、 RFC 7230、 RFC 7231、 RFC 2388、 に基づく、 Mojo::Message::Requestや Mojo::Message::Responseなどの HTTPメッセージの抽象基底クラスです。">
  </head>
  <body>
    <div class="container">
      <div class="header">
        <!-- header -->
<div class="main">
  <h1>
    <a href="/">Mojoliciousドキュメント 日本語訳</a>
  </h1>
</div>

      </div>
      <div class="main">
        <div class="content">
          <div class="entry">
  <div class="top">
    <!-- top -->

  </div>
  <div class="middle">
    <!-- 

<p><a href="/Mojo::Message.html">Mojo::Message</a>は、 <a href="http://tools.ietf.org/html/rfc7230" class="podlinkurl"
>RFC 7230</a>、 <a href="http://tools.ietf.org/html/rfc7231" class="podlinkurl"
>RFC 7231</a>、 <a href="http://tools.ietf.org/html/rfc2388" class="podlinkurl"
>RFC 2388</a>、 に基づく、 <a href="/Mojo::Message::Request.html">Mojo::Message::Request</a>や <a href="/Mojo::Message::Response.html">Mojo::Message::Response</a>などの HTTPメッセージの抽象基底クラスです。</p> -->
<html><head><title>名前</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.40,
  using Pod::Simple::PullParser v3.40,
  under Perl v5.028000 at Wed Sep  2 23:32:12 2020 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<a name='___top' class='dummyTopAnchor' ></a>

<div><a href="/mojo-api-reference.html">Mojolicious API リファレンス</a></div>

<h2><a href="/Mojo::Message.html">Mojo::Message - HTTPメッセージの基底クラス</a></h2>

<h3><a class='u'
name="_"
>使い方</a></h3>

<pre>package Mojo::Message::MyMessage;
use Mojo::Base 'Mojo::Message';

sub cookies              {...}
sub extract_start_line   {...}
sub get_start_line_chunk {...}
sub start_line_size      {...}</pre>

<h3><a class='u'
name="_"
>説明</a></h3>

<p><a href="/Mojo::Message.html">Mojo::Message</a>は、 <a href="http://tools.ietf.org/html/rfc7230" class="podlinkurl"
>RFC 7230</a>、 <a href="http://tools.ietf.org/html/rfc7231" class="podlinkurl"
>RFC 7231</a>、 <a href="http://tools.ietf.org/html/rfc2388" class="podlinkurl"
>RFC 2388</a>、 に基づく、 <a href="/Mojo::Message::Request.html">Mojo::Message::Request</a>や <a href="/Mojo::Message::Response.html">Mojo::Message::Response</a>などの HTTPメッセージの抽象基底クラスです。</p>

<h3><a class='u'
name="_"
>イベント</a></h3>

<p><a href="/Mojo::Message.html">Mojo::Message</a>は<a href="/Mojo::EventEmitter.html">Mojo::EventEmitter</a>からすべてのイベントを継承しており、次のイベントを発行することができます。</p>

<h4><a class='u'
name="finish"
>finish</a></h4>

<pre>$msg-&gt;on(finish =&gt; sub {
  my $msg = shift;
  ...
});</pre>

<p>メッセージが構築され、解析が終了した後に発行されます。</p>

<pre>my $before = time;
$msg-&gt;on(finish =&gt; sub {
  my $msg = shift;
  $msg-&gt;headers-&gt;header('X-Parser-Time' =&gt; time - $before);
});</pre>

<h4><a class='u'
name="progress"
>progress</a></h4>

<pre>$msg-&gt;on(progress =&gt; sub {
  my $msg = shift;
  ...
});</pre>

<p>メッセージが構築され、解析されているときに発行されます。</p>

<pre># 構築
$msg-&gt;on(progress =&gt; sub {
  my ($msg, $state, $offset) = @_;
  say qq{Building "$state" at offset $offset};
});

# 解析
$msg-&gt;on(progress =&gt; sub {
  my $msg = shift;
  return unless my $len = $msg-&gt;headers-&gt;content_length;
  my $size = $msg-&gt;content-&gt;progress;
  say 'Progress: ', $size == $len ? 100 : int($size / ($len / 100)), '%';
});</pre>

<h3><a class='u'
name="_"
>属性</a></h3>

<p><a href="/Mojo::Message.html">Mojo::Message</a>は次の属性を実装しています。</p>

<h4><a class='u'
name="content"
>content</a></h4>

<pre>my $msg = $msg-&gt;content;
$msg    = $msg-&gt;content(Mojo::Content::Single-&gt;new);</pre>

<p>コンテンツのコンテナ。デフォルトは<a href="/Mojo::Content::Single.html">Mojo::Content::Single</a>オブジェクトです。</p>

<h4><a class='u'
name="default_charset"
>default_charset</a></h4>

<pre>my $charset = $msg-&gt;default_charset;
$msg        = $msg-&gt;default_charset('UTF-8');</pre>

<p><code>text</code>と、 <code>application/x-www-form-urlencoded</code>、<code>multipart/form-data</code> message body を抽出するときに利用される デフォルトの文字セット。 デフォルトは<code>UTF-8</code>です。</p>

<h4><a class='u'
name="max_line_size"
>max_line_size</a></h4>

<pre>my $size = $msg-&gt;max_line_size;
$msg     = $msg-&gt;max_line_size(1024);</pre>

<p>スタートラインの最大バイトサイズ。 デフォルトは、<code>MOJO_MAX_LINE_SIZE</code>環境変数の値、 あるいは<code>8192</code> (8KB)。</p>

<h4><a class='u'
name="max_message_size"
>max_message_size</a></h4>

<pre>my $size = $msg-&gt;max_message_size;
$msg     = $msg-&gt;max_message_size(1024);</pre>

<p>最大メッセージバイトサイズ。デフォルトは<code>MOJO_MAX_MESSAGE_SIZE</code>環境変数の値か<code>16777216</code> (16MB)です。 0に設定する無制限のサイズのメッセージを許可します。</p>

<h4><a class='u'
name="version"
>version</a></h4>

<pre>my $version = $msg-&gt;version;
$msg    = $msg-&gt;version('1.1');</pre>

<p>メッセージのHTTPのバージョン。デフォルトは<code>1.1</code>。</p>

<h3><a class='u'
name="_"
>メソッド</a></h3>

<p><a href="/Mojo::Message.html">Mojo::Message</a>は<a href="/Mojo::EventEmitter.html">Mojo::EventEmitter</a>からすべてのメソッドを継承しており、 次の新しいメソッドを実装しています。</p>

<h4><a class='u'
name="body"
>body</a></h4>

<pre>my $bytes = $msg-&gt;body;
$msg      = $msg-&gt;body('Hello!');</pre>

<p><code>content</code>を取得あるいは置換します。 <a href="/Mojo::Content::MultiPart.html">Mojo::Content::MultiPart</a>は自動的に<a href="/Mojo::Content::Single.html">Mojo::Content::Single</a>をダウングレードされます。</p>

<h4><a class='u'
name="body_params"
>body_params</a></h4>

<pre>my $params = $msg-&gt;body_params;</pre>

<p><code>x-application-urlencoded</code>,c<application/x-www-form-urlencoded>,あるいは<code>multipart/form-data</code> メッセージボディから展開された<code>POST</code>パラメーター。通常は<a href="/Mojo::Parameters.html">Mojo::Parameters</a>オブジェクトです。 このメソッドはすべてのデータをキャッシュするので、 完全なメッセージボディが到着する前に呼び出してはいけないということに 注意してください。 メッセージボディの各部分は<code>POST</code>パラメーターを解析するために メモリ上にロードされるので、 大きすぎないようにする必要があります。 デフォルトで、リクエストに対して16MiBの制限と、レスポンスに対して2GiBの制限があります。</p>

<pre># POSTパラメーターの値を取得します
say $msg-&gt;body_params-&gt;param('foo');</pre>

<h4><a class='u'
name="body_size"
>body_size</a></h4>

<pre>my $size = $msg-&gt;body_size;</pre>

<p>コンテンツのバイトサイズ。</p>

<h4><a class='u'
name="build_body"
>build_body</a></h4>

<pre>my $bytes = $msg-&gt;build_body;</pre>

<p>"get_body_chunk"で、ボディ全体を描画します。</p>

<h4><a class='u'
name="build_headers"
>build_headers</a></h4>

<pre>my $bytes = $msg-&gt;build_headers;</pre>

<p>"get_header_chunk"で、すべてのヘッダーを描画します。</p>

<h4><a class='u'
name="build_start_line"
>build_start_line</a></h4>

<pre>my $bytes = $msg-&gt;build_start_line;</pre>

<p>"get_start_line_chunk"で、スタートラインを描画します。</p>

<h4><a class='u'
name="cookie"
>cookie</a></h4>

<pre>my $cookie = $msg-&gt;cookie('foo');</pre>

<p>メッセージのクッキーにアクセスします。 通常は<a href="/Mojo::Cookie::Request.html">Mojo::Cookie::Request</a>か<a href="/Mojo::Cookie::Response.html">Mojo::Cookie::Response</a>オブジェクトです。 もし同じ名前で共有されている複数のクッキーがあり、 最後のひとつより多くの値にアクセスしたい場合は、 <code>every_cookie</code>を使うことができます。 このメソッドはすべてのデータをキャッシュするので、 すべてのヘッダーが到着する前によびだしてはいけない ということに注意してください。</p>

<pre># クッキーの値を取得
say $msg-&gt;cookie('foo')-&gt;value;</pre>

<h4><a class='u'
name="cookies"
>cookies</a></h4>

<pre>my $cookies = $msg-&gt;cookies;</pre>

<p>メッセージクッキーへのアクセス。 サブクラスでオーバーロードされます。</p>

<h4><a class='u'
name="dom"
>dom</a></h4>

<pre>my $dom        = $msg-&gt;dom;
my $collection = $msg-&gt;dom('a[href]');</pre>

<p><code>text</code>からメッセージボディを取り出し、コンテンツを<a href="/Mojo::DOM.html">Mojo::DOM</a>オブジェクトに変換します。 オプションでセレクタを与えるとすぐに<code>find</code>を実行し、 集合を返却します。これは<a href="/Mojo::Collection.html">Mojo::Collection</a>オブジェクトです。 このメソッドはすべてのデータをキャッシュするので、 完全なメッセージボディが到着するまで、 呼び出してはいけません。 メッセージボデ全体が メモリ上にロードされるので、 大きすぎないようにする必要があります。 デフォルトで、リクエストに対して16MiBの制限と、レスポンスに対して2GiBの制限があります。</p>

<pre># "find"をすぐに実行
say $msg-&gt;dom('h1, h2, h3')-&gt;map('text')-&gt;join("\n");

# それ以外はMojo::DOMが提供するものを使う
say $msg-&gt;dom-&gt;at('title')-&gt;text;
say $msg-&gt;dom-&gt;at('body')-&gt;children-&gt;map('tag')-&gt;uniq-&gt;join("\n");</pre>

<h4><a class='u'
name="error"
>error</a></h4>

<pre>my $err = $msg-&gt;error;
$msg    = $msg-&gt;error({message =&gt; 'Parser error'});</pre>

<p>エラーメッセージを取得、設定します。 <code>undef</code>という戻り値は、エラーが無かったことを意味します。</p>

<pre># 接続エラー、あるいは解析エラー
$msg-&gt;error({message =&gt; 'Connection refused'});

# 4xx/5xx レスポンス
$msg-&gt;error({message =&gt; 'Internal Server Error', code =&gt; 500});</pre>

<h4><a class='u'
name="every_cookie"
>every_cookie</a></h4>

<pre>my $cookies = $msg-&gt;every_cookie('foo');</pre>

<p><code>cookie</code>と似ていますが、同じ名前で共有されている、 すべてのメッセージクッキーを、配列のリファレンスとして 取得します。</p>

<pre># 最初のクッキーの値を取得
say $msg-&gt;every_cookie('foo')-&gt;[0]-&gt;value;</pre>

<h4><a class='u'
name="every_upload"
>every_upload</a></h4>

<pre>my $uploads = $msg-&gt;every_upload('foo');</pre>

<p><code>upload</code>と似ていますが、同じ名前で共有されている すべてのファイルアップロードを配列のリファレンスとして、 取得します。</p>

<pre># 最初にアップロードされたファイルの内容を取得
say $msg-&gt;every_upload('foo')-&gt;[0]-&gt;asset-&gt;slurp;</pre>

<h4><a class='u'
name="extract_start_line"
>extract_start_line</a></h4>

<pre>my $bool = $msg-&gt;extract_start_line(\$str);</pre>

<p>文字列からスタートラインを抽出します。 これはサブクラスでオーバーロードされます。</p>

<h4><a class='u'
name="finish"
>finish</a></h4>

<pre>$msg = $msg-&gt;finish;</pre>

<p>メッセージの解析/生成を終了します。</p>

<h4><a class='u'
name="fix_headers"
>fix_headers</a></h4>

<pre>$msg = $msg-&gt;fix_headers;</pre>

<p>メッセーが現在のHTTPのバージョンに要求されるすべてのヘッダーを持っていることを確かにします。</p>

<h4><a class='u'
name="get_body_chunk"
>get_body_chunk</a></h4>

<pre>my $string = $msg-&gt;get_body_chunk($offset);</pre>

<p>特定の位置から開始して、ボディのデータの断片を取得します。 コンテンツが動的に生成されている場合は、同じチャンクを二度取得することはできないことに注意してください。</p>

<h4><a class='u'
name="get_header_chunk"
>get_header_chunk</a></h4>

<pre>my $string = $msg-&gt;get_header_chunk($offset);</pre>

<p>特定の位置から開始して、ヘッダーのデータの断片を取得します。このメソッドはメッセージをファイナライズすることに注意してください。</p>

<h4><a class='u'
name="get_start_line_chunk"
>get_start_line_chunk</a></h4>

<pre>my $string = $msg-&gt;get_start_line_chunk($offset);</pre>

<p>特定の位置から開始して、スタートラインのデータの断片を取得します。サブクラスでオーバーロードされることが予定されています。</p>

<h4><a class='u'
name="header_size"
>header_size</a></h4>

<pre># 長いバージョン
my $headers = $msg-&gt;content-&gt;headers;</pre>

<p>ヘッダーのバイトサイズ。このメソッドはメッセージをファイナライズすることに注意してください。</p>

<h4><a class='u'
name="headers"
>headers</a></h4>

<pre>my $headers = $msg-&gt;headers;
$msg    = $msg-&gt;headers(Mojo::Headers-&gt;new);</pre>

<p>メッセージのヘッダ。通常は<a href="/Mojo::Headers.html">Mojo::Headers</a>オブジェクト。</p>

<pre># 長いバージョン
my $headers = $msg-&gt;content-&gt;headers;</pre>

<h4><a class='u'
name="is_finished"
>is_finished</a></h4>

<pre>my $bool = $msg-&gt;is_finished;</pre>

<p>メッセージの解析/生成が終了しているかどうかをチェックします。</p>

<h4><a class='u'
name="is_limit_exceeded"
>is_limit_exceeded</a></h4>

<pre>my $bool = $msg-&gt;is_limit_exceeded;</pre>

<p>メッセージが<code>max_line_size</code>あるいは<code>max_message_size</code>、<a href="/Mojo::Content.html">Mojo::Content</a>の"max_buffer_size"、<a href="/Mojo::Headers.html">Mojo::Headers</a>の"max_line_size"を超えていないかをチェックします。</p>

<h4><a class='u'
name="json"
>json</a></h4>

<pre>my $value = $msg-&gt;json;
my $value = $msg-&gt;json('/foo/bar');</pre>

<p>可能であれば<a href="/Mojo::JSON.html">Mojo::JSON</a>を使ってJSONのメッセージボディを直接でコードします。 <code>undef</code>という戻り値は、生の<code>null</code>あるいは、デコードが失敗したことを意味します。 オプションとして、<a href="/Mojo::JSON::Pointer.html">Mojo::JSON::Pointer</a>を使って、JSONポインタで特定の値を抽出することができます。</p>

<p>このメソッドはすべてのデータをキャッシュするので、 完全なメッセージボディが到着するまで、呼び出してはいけません。 メッセージボデ全体がメモリ上にロードされるので、 大きすぎないようにする必要があります。 デフォルトで、リクエストに対して16MiBの制限と、レスポンスに対して2GiBの制限があります。</p>

<pre># JSONの値を抽出
say $msg-&gt;json-&gt;{foo}{bar}[23];
say $msg-&gt;json('/foo/bar/23');</pre>

<h4><a class='u'
name="parse"
>parse</a></h4>

<pre>$msg = $msg-&gt;parse('HTTP/1.1 200 OK...');</pre>

<p>メッセージの断片を解析します。</p>

<h4><a class='u'
name="save_to"
>save_to</a></h4>

<pre>$msg = $msg-&gt;save_to('/some/path/index.html');</pre>

<p>メッセージボディをファイルに保存します。</p>

<h4><a class='u'
name="start_line_size"
>start_line_size</a></h4>

<pre>my $size = $msg-&gt;start_line_size;</pre>

<p>スタートラインのバイトサイズ。サブクラスでオーバーロードすることが予定されています。</p>

<h4><a class='u'
name="text"
>text</a></h4>

<pre>my $str = $msg-&gt;text;</pre>

<p><code>body</code>を取り出して、キャラクターセットが<a href="/Mojo::Content.html">Mojo::Content</a>の<code>charset</code>で抽出できれば、デコードしようと試みます。</p>

<h4><a class='u'
name="to_string"
>to_string</a></h4>

<pre>my $string = $msg-&gt;to_string;</pre>

<p>メッセージ全体を描画します。このメソッドは、メッセージをファイナライズすることと、コンテンツが動的に生成された場合は、同じメッセージを二回描画できないことに注意してください。</p>

<h4><a class='u'
name="upload"
>upload</a></h4>

<pre>my $upload = $msg-&gt;upload('foo');</pre>

<p><code>multipart/form-data</code>でアップロードされたファイルにアクセスします。 通常は<a href="/Mojo::Upload.html">Mojo::Upload</a>です。 もし同じ名前で共有される複数のアップロードがあるなら、 最後のひとつの値より多くの値にアクセスしたい場合は、 <code>every_upload</code>を使ってください。 このメソッドはすべてのデータをキャッシュするので、 完全なメッセージボディが到着する前に呼び出さないように 注意する必要があります。</p>

<pre># アップロードされたファイルのコンテンツを取得
say $msg-&gt;upload('foo')-&gt;asset-&gt;slurp;</pre>

<h4><a class='u'
name="uploads"
>uploads</a></h4>

<pre>my $uploads = $msg-&gt;uploads;</pre>

<p><code>multipart/form-data</code>アップロードされたすべてのファイル。 通常は<a href="/Mojo::Upload.html">Mojo::Upload</a>オブジェクトです。</p>

<pre># すべてのアップロードの名前
say $_-&gt;name for @{$msg-&gt;uploads};</pre>

<h3><a class='u'
name="_"
>参考</a></h3>

<p><a href="https://metacpan.org/pod/Mojolicious" class="podlinkpod"
>Mojolicious</a>, <a href="https://metacpan.org/pod/Mojolicious%3A%3AGuides" class="podlinkpod"
>Mojolicious::Guides</a>, <a href="http://mojolicio.us" class="podlinkurl"
>http://mojolicio.us</a>.</p>

<p>(Mojolicious 8.12を反映。2019年5月23日)</p>

<!-- end doc -->

</body></html>

  </div>
  <div class="bottom">
    <!-- bottom -->

  </div>
</div>

        </div>
        <div class="side">
          <!-- side -->
<div class="side-list">
  <div class="side-list-title">
  　ドキュメント
  </div>
  <ul>
    <li><a href="/">ドキュメントトップ</a></li>
    <li><a href="/Mojolicious::Guides::Tutorial.html">Mojoliciousを始めよう</a></li>
    <li><a href="/Mojolicious::Guides::Routing.html">ルーティング</a></li>
    <li><a href="/Mojolicious::Guides::Rendering.html">テンプレート描画</a></li>
    <li><a href="/Mojolicious::Guides::Growing.html">Mojoliciousの成長</a></li>
    <li><a href="/Mojolicious::Guides::Cookbook.html">クックブック</a></li>
    <li><a href="/Mojolicious::Guides::Contributing.html">Mojoliciousへの貢献</a></li>
    <li><a href="/Mojolicious::Guides::FAQ.html">よくある質問</a></li>
  </ul>
</div>

<div class="side-list">
  <div class="side-list-title">
  　APIリファレンス
  </div>
  <ul>
    <li><a href="/mojo-api-reference.html">API リファレンス</a></li>
  </ul>
</div>

        </div>
      </div>
      <div class="footer">
        <div class="kimoto_system_link">
  <a href="https://kimoto-system.co.jp">
    <img src="https://kimoto-system.co.jp/images/kimoto-system-logo.png" alt="Perl Webシステム開発">
    リアルタイムWebとクラウドサーバー対応の<br>Perl、Linux、Gitなどのオープンソースを使った<br>Webシステム開発なら木本システム
  </a>
</div>

<div class="copyright">
  Copyright © Yuki Kimoto
</div>

      </div>
    </div>
  </body>
</html>
